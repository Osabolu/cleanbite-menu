<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanBite Empire | Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ==================== YOUR EXISTING STYLES HERE ==================== */
        /* Keep all your existing CSS styles exactly as they are */
        :root {
            --primary: #ffd700;
            --primary-dark: #e6c200;
            --primary-light: #fff9e6;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --success-light: #e8f5e9;
            --warning: #f39c12;
            --warning-light: #fff3e0;
            --danger: #e74c3c;
            --danger-light: #ffebee;
            --info: #3498db;
            --info-light: #e3f2fd;
            --purple: #9b59b6;
            --purple-light: #f3e5f5;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --gray-light: #ecf0f1;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
            --border-radius: 24px;
            --card-radius: 28px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f0f2f5;
            color: var(--dark);
            overflow-x: hidden;
        }

        /* Navigation */
        .admin-nav {
            background: white;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(237, 242, 247, 0.8);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-brand i {
            font-size: 32px;
            color: var(--primary);
            filter: drop-shadow(0 4px 8px rgba(255,215,0,0.2));
        }

        .nav-brand h1 {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--dark);
            letter-spacing: 1px;
        }

        .nav-brand span {
            color: var(--primary);
            font-weight: 800;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 700;
            color: var(--dark);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-name i {
            color: var(--primary);
            font-size: 1.1rem;
        }

        .user-role {
            font-size: 12px;
            color: var(--gray);
            font-weight: 500;
        }

        .logout-btn {
            background: linear-gradient(135deg, #fee9e7, #fde2e0);
            color: var(--danger);
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(231, 76, 60, 0.2);
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #fde2e0, #fcd5d2);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(231, 76, 60, 0.15);
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #edf2f7;
            padding: 30px 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 4px 0 20px rgba(0,0,0,0.02);
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 0 20px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 24px;
            border-radius: 16px;
            color: #7f8c8d;
            text-decoration: none;
            transition: var(--transition);
            position: relative;
            font-weight: 500;
        }

        .menu-item i {
            width: 24px;
            font-size: 1.3rem;
            color: var(--gray);
            transition: var(--transition);
        }

        .menu-item:hover {
            background: var(--primary-light);
            color: var(--primary);
            transform: translateX(5px);
        }

        .menu-item:hover i {
            color: var(--primary);
        }

        .menu-item.active {
            background: linear-gradient(135deg, var(--primary-light), #fff3cd);
            color: var(--primary);
            font-weight: 600;
            border-left: 4px solid var(--primary);
        }

        .menu-item.active i {
            color: var(--primary);
        }

        .menu-item .badge {
            position: absolute;
            right: 20px;
            background: var(--warning);
            color: white;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(243,156,18,0.2);
        }

        .sidebar-footer {
            padding: 20px;
            text-align: center;
            color: var(--gray);
            font-size: 12px;
            border-top: 1px solid #edf2f7;
            margin: 20px 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .sidebar-footer i {
            color: var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px 40px;
            background: #f8fafc;
            overflow-y: auto;
        }

        /* Payment Notice */
        .payment-notice {
            display: none;
            align-items: center;
            gap: 20px;
            background: linear-gradient(135deg, var(--primary-light) 0%, #fff3cd 100%);
            border: 1px solid var(--primary);
            border-left: 6px solid var(--warning);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(243, 156, 18, 0.15);
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .payment-notice i {
            font-size: 32px;
            color: var(--warning);
            filter: drop-shadow(0 4px 10px rgba(243,156,18,0.3));
        }

        .payment-notice-content {
            flex: 1;
        }

        .payment-notice-content h4 {
            color: var(--dark);
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .payment-notice-content h4 i {
            color: var(--warning);
        }

        .payment-notice-content p {
            color: #5a6a7a;
            margin: 0;
            font-size: 14px;
        }

        .payment-notice .badge {
            background: var(--warning);
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 8px 20px rgba(243,156,18,0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: white;
            border-radius: 24px;
            padding: 28px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            border: 1px solid rgba(237, 242, 247, 0.8);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: var(--transition);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .stat-card.revenue .stat-icon {
            background: linear-gradient(135deg, var(--success-light), #c8e6c9);
            color: var(--success);
        }

        .stat-card.pending .stat-icon {
            background: linear-gradient(135deg, var(--warning-light), #ffe0b2);
            color: var(--warning);
        }

        .stat-card.verified .stat-icon {
            background: linear-gradient(135deg, var(--info-light), #bbdefb);
            color: var(--info);
        }

        .stat-card.customers .stat-icon {
            background: linear-gradient(135deg, var(--purple-light), #e1bee7);
            color: var(--purple);
        }

        .stat-value {
            font-size: 2.6rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 8px;
            line-height: 1;
            letter-spacing: -0.5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-label i {
            color: var(--primary);
            font-size: 14px;
        }

        /* Filter Bar */
        .filter-bar {
            background: white;
            border-radius: 20px;
            padding: 20px 25px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.02);
            border: 1px solid #edf2f7;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            flex: 1;
        }

        .filter-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
        }

        .filter-label i {
            color: var(--primary);
        }

        .filter-select {
            padding: 12px 20px;
            border: 2px solid #edf2f7;
            border-radius: 50px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            color: var(--dark);
            background: white;
            cursor: pointer;
            min-width: 180px;
            transition: var(--transition);
        }

        .filter-select:hover {
            border-color: var(--primary);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,215,0,0.1);
        }

        .filter-search {
            flex: 1;
            position: relative;
            min-width: 250px;
        }

        .filter-search i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .filter-search input {
            width: 100%;
            padding: 12px 20px 12px 50px;
            border: 2px solid #edf2f7;
            border-radius: 50px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: var(--transition);
        }

        .filter-search input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,215,0,0.1);
        }

        .filter-actions {
            display: flex;
            gap: 12px;
        }

        .filter-btn {
            background: white;
            border: 1px solid #edf2f7;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--dark);
        }

        /* Payment Verification Queue */
        .verification-section {
            background: white;
            border-radius: 28px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.03);
            border: 1px solid #edf2f7;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h3 {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header h3 i {
            color: var(--warning);
        }

        .section-count {
            background: linear-gradient(135deg, #f8f9fa, #edf2f7);
            color: var(--dark);
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 700;
            border: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-count i {
            color: var(--warning);
        }

        .verification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }

        .verification-card {
            background: #f8f9fa;
            border-radius: 24px;
            padding: 25px;
            border: 1px solid #edf2f7;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .verification-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 15px 35px rgba(255,215,0,0.1);
        }

        .verification-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--warning), var(--primary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .verification-card:hover::before {
            opacity: 1;
        }

        .verification-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .verification-order-id {
            background: linear-gradient(135deg, var(--dark), #34495e);
            color: white;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .verification-time {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gray);
            font-size: 12px;
        }

        .verification-time i {
            color: var(--warning);
        }

        .verification-customer {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #edf2f7;
        }

        .customer-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-light), #fff3cd);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
        }

        .customer-details h4 {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .customer-details p {
            color: var(--gray);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .verification-items {
            background: white;
            border-radius: 18px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .verification-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed #edf2f7;
        }

        .verification-item-row:last-child {
            border-bottom: none;
        }

        .item-name {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .item-quantity {
            background: var(--primary-light);
            color: var(--primary);
            padding: 3px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }

        .item-price {
            font-weight: 600;
            color: var(--success);
        }

        .verification-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .verification-amount {
            font-weight: 800;
            color: var(--success);
            font-size: 1.8rem;
        }

        .verification-actions {
            display: flex;
            gap: 10px;
        }

        .btn-verify {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-verify:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(46,204,113,0.3);
        }

        .btn-verify:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-reject {
            background: white;
            color: var(--danger);
            border: 2px solid #fde2e2;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-reject:hover {
            background: var(--danger-light);
            border-color: var(--danger);
            transform: translateY(-3px);
        }

        .btn-reject:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .empty-queue {
            text-align: center;
            padding: 60px 20px;
            background: #f8f9fa;
            border-radius: 24px;
            color: var(--gray);
        }

        .empty-queue i {
            font-size: 60px;
            color: var(--primary);
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-queue p {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        /* Orders Tabs */
        .orders-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 14px 28px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .tab-btn i {
            font-size: 1.1rem;
        }

        .tab-btn.verified {
            background: var(--info-light);
            color: var(--info);
        }

        .tab-btn.verified.active {
            background: var(--info);
            color: white;
        }

        .tab-btn.cancelled {
            background: var(--danger-light);
            color: var(--danger);
        }

        .tab-btn.cancelled.active {
            background: var(--danger);
            color: white;
        }

        .tab-btn.all {
            background: var(--gray-light);
            color: var(--dark);
        }

        .tab-btn.all.active {
            background: var(--dark);
            color: white;
        }

        .tab-btn.pending {
            background: var(--warning-light);
            color: var(--warning);
        }

        .tab-btn.pending.active {
            background: var(--warning);
            color: white;
        }

        /* Orders Grid */
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .order-card {
            background: white;
            border-radius: 28px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.03);
            border: 1px solid #edf2f7;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .order-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .order-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary);
        }

        .order-card:hover::before {
            opacity: 1;
        }

        .order-card.verified-card {
            border-left: 4px solid var(--success);
        }

        .order-card.cancelled-card {
            border-left: 4px solid var(--danger);
            opacity: 0.9;
        }

        .order-card.pending-card {
            border-left: 4px solid var(--warning);
        }

        .order-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .order-badge {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-id-badge {
            background: linear-gradient(135deg, var(--dark), #34495e);
            color: white;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 13px;
            font-weight: 700;
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 40px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .status-badge.preparing {
            background: var(--info-light);
            color: var(--info);
        }

        .status-badge.incubating {
            background: var(--purple-light);
            color: var(--purple);
        }

        .status-badge.ready {
            background: var(--success-light);
            color: var(--success);
        }

        .status-badge.completed {
            background: var(--gray-light);
            color: var(--gray);
        }

        .status-badge.cancelled {
            background: var(--danger-light);
            color: var(--danger);
        }

        .status-badge.pending {
            background: var(--warning-light);
            color: var(--warning);
        }

        .payment-badge {
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .payment-badge.verified {
            background: var(--success-light);
            color: var(--success);
        }

        .payment-badge.pending {
            background: var(--warning-light);
            color: var(--warning);
        }

        .payment-badge.rejected {
            background: var(--danger-light);
            color: var(--danger);
        }

        .order-time {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gray);
            font-size: 12px;
        }

        .order-time i {
            color: var(--primary);
        }

        .order-customer-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #edf2f7;
        }

        .customer-avatar-large {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-light), #fff3cd);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
        }

        .customer-info-detailed {
            flex: 1;
        }

        .customer-info-detailed h4 {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .customer-contact {
            display: flex;
            flex-direction: column;
            gap: 5px;
            color: var(--gray);
            font-size: 12px;
        }

        .customer-contact span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .order-items-list {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .order-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #edf2f7;
        }

        .order-item-row:last-child {
            border-bottom: none;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-quantity-badge {
            background: var(--primary);
            color: var(--dark);
            width: 32px;
            height: 32px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .item-name {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .item-price {
            font-weight: 600;
            color: var(--success);
        }

        /* Timeline Progress */
        .order-timeline {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 20px;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 12px;
            color: var(--gray);
        }

        .timeline-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin: 20px 0;
        }

        .timeline-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: #edf2f7;
            z-index: 1;
        }

        .timeline-step {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .step-icon {
            width: 32px;
            height: 32px;
            background: white;
            border: 2px solid #edf2f7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 14px;
        }

        .step-icon.completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .step-icon.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--dark);
            box-shadow: 0 0 0 4px rgba(255,215,0,0.2);
        }

        .step-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--gray);
        }

        .step-label.active {
            color: var(--primary);
        }

        .step-label.completed {
            color: var(--success);
        }

        /* Incubation Timer */
        .incubation-timer {
            background: var(--info-light);
            border-radius: 16px;
            padding: 15px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .timer-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-info i {
            color: var(--info);
            font-size: 1.2rem;
        }

        .timer-text {
            font-size: 12px;
            color: var(--dark);
        }

        .timer-text strong {
            color: var(--info);
            font-size: 1rem;
        }

        .progress-bar {
            width: 100px;
            height: 8px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--info);
            border-radius: 10px;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #edf2f7;
        }

        .order-total {
            display: flex;
            flex-direction: column;
        }

        .total-label {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .total-amount {
            font-weight: 800;
            color: var(--success);
            font-size: 1.8rem;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            padding: 10px 20px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-action.update {
            background: linear-gradient(135deg, var(--info), #2980b9);
            color: white;
        }

        .btn-action.complete {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }

        .btn-action.verify {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }

        .btn-action.reject {
            background: white;
            color: var(--danger);
            border: 2px solid #fde2e2;
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .btn-action:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Customer Section */
        .customer-section {
            background: white;
            border-radius: 28px;
            padding: 30px;
            margin-bottom: 35px;
        }

        .customers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .customers-grid::-webkit-scrollbar {
            width: 8px;
        }

        .customers-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .customers-grid::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .customer-card {
            background: #f8f9fa;
            border-radius: 24px;
            padding: 25px;
            border: 1px solid #edf2f7;
            transition: var(--transition);
        }

        .customer-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
        }

        .customer-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .customer-avatar-lg {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-light), #fff3cd);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--primary);
        }

        .customer-title h4 {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .customer-title p {
            color: var(--gray);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .customer-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .customer-stat-item {
            background: white;
            padding: 15px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid #edf2f7;
        }

        .customer-stat-value {
            font-weight: 800;
            color: var(--dark);
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .customer-stat-label {
            font-size: 11px;
            color: var(--gray);
        }

        .customer-contact-info {
            background: white;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .contact-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px dashed #edf2f7;
        }

        .contact-row:last-child {
            border-bottom: none;
        }

        .contact-row i {
            color: var(--primary);
            width: 20px;
        }

        .contact-row span {
            color: var(--gray);
            font-size: 13px;
        }

        .customer-orders-preview {
            background: white;
            border-radius: 16px;
            padding: 15px;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 12px;
            color: var(--gray);
        }

        .preview-order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #edf2f7;
            font-size: 12px;
        }

        .preview-order-item:last-child {
            border-bottom: none;
        }

        .preview-order-id {
            font-weight: 600;
            color: var(--dark);
        }

        .preview-order-status {
            padding: 3px 10px;
            border-radius: 30px;
            font-size: 10px;
            font-weight: 600;
        }

        .view-customer-btn {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background: var(--primary);
            color: var(--dark);
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .view-customer-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Activity Feed */
        .activity-section {
            background: white;
            border-radius: 28px;
            padding: 30px;
            margin-top: 35px;
        }

        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 15px;
        }

        .activity-feed::-webkit-scrollbar {
            width: 8px;
        }

        .activity-feed::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .activity-feed::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 18px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 20px;
            border-left: 5px solid;
            transition: var(--transition);
            animation: slideInLeft 0.4s ease;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .activity-item:hover {
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transform: translateX(5px);
        }

        .activity-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-message {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .activity-order, .activity-customer {
            font-size: 11px;
            padding: 5px 15px;
            border-radius: 30px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .activity-order {
            background: #e9ecef;
            color: var(--dark);
        }

        .activity-customer {
            background: var(--warning-light);
            color: var(--warning);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 32px;
            width: 90%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalZoom 0.4s ease;
        }

        @keyframes modalZoom {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid #edf2f7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-header h3 i {
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 32px;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--danger-light);
            color: var(--danger);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .order-info {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed #edf2f7;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: var(--gray);
        }

        .info-value {
            font-weight: 700;
            color: var(--dark);
        }

        .info-value.highlight {
            color: var(--success);
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group textarea,
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #edf2f7;
            border-radius: 20px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-group textarea:focus,
        .form-group select:focus,
        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(255,215,0,0.1);
        }

        .status-options {
            margin: 20px 0;
        }

        .status-option {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px 16px;
            border: 1px solid #e9ecef;
            border-radius: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .status-option:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .status-option input[type="radio"] {
            margin-right: 15px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }

        .status-option .status-badge {
            margin-right: auto;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-modal {
            flex: 1;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-modal.primary {
            background: var(--primary);
            color: var(--dark);
        }

        .btn-modal.primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255,215,0,0.3);
        }

        .btn-modal.primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-modal.secondary {
            background: #f1f5f9;
            color: var(--dark);
        }

        .btn-modal.secondary:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .btn-modal.danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-modal.danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(231,76,60,0.3);
        }

        .btn-modal.danger:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Notification Toast */
        .notification-toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            border-left: 6px solid;
            border-radius: 20px;
            padding: 20px 25px;
            min-width: 380px;
            max-width: 450px;
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            z-index: 9999;
            animation: slideInRight 0.4s ease;
        }

        .notification-toast.success { border-left-color: var(--success); }
        .notification-toast.warning { border-left-color: var(--warning); }
        .notification-toast.error { border-left-color: var(--danger); }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .verification-grid { grid-template-columns: 1fr; }
            .orders-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .main-content { padding: 20px; }
            .filter-bar { flex-direction: column; }
            .filter-group { width: 100%; }
            .customers-grid { grid-template-columns: 1fr; }
            .modal-content { width: 95%; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="admin-nav">
        <div class="nav-brand">
            <i class="fas fa-crown"></i>
            <h1>CLEAN<span>BITE</span></h1>
        </div>
        <div class="nav-user">
            <div class="user-info">
                <div class="user-name">
                    <i class="fas fa-user-shield"></i>
                    Administrator
                </div>
                <div class="user-role">Super Admin</div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" id="dashboardTab">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item" id="verificationTab">
                    <i class="fas fa-check-circle"></i>
                    <span>Verification Queue</span>
                    <span class="badge" id="verificationBadge">0</span>
                </a>
                <a href="#" class="menu-item" id="verifiedOrdersTab">
                    <i class="fas fa-check-double"></i>
                    <span>Verified Orders</span>
                    <span class="badge" id="verifiedBadge" style="background: var(--success);">0</span>
                </a>
                <a href="#" class="menu-item" id="cancelledOrdersTab">
                    <i class="fas fa-times-circle"></i>
                    <span>Cancelled Orders</span>
                    <span class="badge" id="cancelledBadge" style="background: var(--danger);">0</span>
                </a>
                <a href="#" class="menu-item" id="customersTab">
                    <i class="fas fa-users"></i>
                    <span>Customers</span>
                </a>
                <a href="#" class="menu-item" id="activityTab">
                    <i class="fas fa-stream"></i>
                    <span>Activity Feed</span>
                </a>
            </div>
            <div class="sidebar-footer">
                <i class="fas fa-database"></i> Firebase Live Sync
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Content will be dynamically loaded here -->
        </div>
    </div>

    <!-- Verify Modal -->
    <div class="modal" id="verifyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-check-circle"></i> Verify Payment</h3>
                <button class="modal-close" id="closeVerifyModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-info" id="verifyOrderInfo">
                    <div class="info-row">
                        <span class="info-label">Order ID:</span>
                        <span class="info-value" id="verifyOrderId">CB-000000</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Customer:</span>
                        <span class="info-value" id="verifyCustomerName">John Doe</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Amount:</span>
                        <span class="info-value highlight" id="verifyAmount">0</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Payment Method:</span>
                        <span class="info-value" id="verifyMethod">Bank Transfer</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="verificationNotes">Verification Notes (Optional)</label>
                    <textarea id="verificationNotes" rows="4" placeholder="Add any notes about this verification..."></textarea>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-modal secondary" id="cancelVerification">Cancel</button>
                    <button class="btn-modal primary" id="confirmVerification">
                        <i class="fas fa-check"></i> Verify Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reject Modal -->
    <div class="modal" id="rejectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-times-circle"></i> Reject Payment</h3>
                <button class="modal-close" id="closeRejectModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-info" id="rejectOrderInfo">
                    <div class="info-row">
                        <span class="info-label">Order ID:</span>
                        <span class="info-value" id="rejectOrderId">CB-000000</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Customer:</span>
                        <span class="info-value" id="rejectCustomerName">John Doe</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Amount:</span>
                        <span class="info-value" id="rejectAmount">0</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="rejectionReason">Rejection Reason *</label>
                    <textarea id="rejectionReason" rows="4" placeholder="Please provide the reason for rejection..." required></textarea>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-modal secondary" id="cancelRejection">Back</button>
                    <button class="btn-modal danger" id="confirmRejection">
                        <i class="fas fa-times"></i> Reject Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Modal -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sync-alt"></i> Update Order Status</h3>
                <button class="modal-close" id="closeStatusModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-info" id="statusOrderInfo">
                    <div class="info-row">
                        <span class="info-label">Order ID:</span>
                        <span class="info-value" id="statusOrderId">CB-000000</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Customer:</span>
                        <span class="info-value" id="statusCustomerName">John Doe</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Current Status:</span>
                        <span class="info-value" id="currentStatus">preparing</span>
                    </div>
                </div>
                
                <div class="status-options" id="statusOptions">
                    <!-- Status options will be populated dynamically -->
                </div>
                
                <div class="modal-actions">
                    <button class="btn-modal secondary" id="cancelUpdate">Cancel</button>
                    <button class="btn-modal primary" id="confirmUpdate">
                        <i class="fas fa-check"></i> Update Status
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-circle"></i> Customer Details</h3>
                <button class="modal-close" id="closeCustomerModal">&times;</button>
            </div>
            <div class="modal-body" id="customerModalBody">
                <!-- Customer details will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div class="modal" id="filterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-filter"></i> Filter Orders</h3>
                <button class="modal-close" id="closeFilterModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Status</label>
                    <select id="filterStatus" class="form-control">
                        <option value="all">All Orders</option>
                        <option value="pending-payment">Pending Payment</option>
                        <option value="preparing">Preparing</option>
                        <option value="incubating">Incubating</option>
                        <option value="ready">Ready</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date Range</label>
                    <select id="filterDate" class="form-control">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="btn-modal secondary" id="clearFilters">Clear</button>
                    <button class="btn-modal primary" id="applyFilters">Apply Filters</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
    // ==================== FIREBASE CONFIG ====================
    const firebaseConfig = {
        apiKey: "AIzaSyC1WaO1WE-LFayAqLeql0BP5vD8bddgUuE",
        authDomain: "cleanbite-empire.firebaseapp.com",
        databaseURL: "https://cleanbite-empire-default-rtdb.firebaseio.com",
        projectId: "cleanbite-empire",
        storageBucket: "cleanbite-empire.firebasestorage.app",
        messagingSenderId: "733995841314",
        appId: "1:733995841314:web:d82f5452f1fff0fdfad77b"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    window.database = firebase.database();
    const database = window.database;

    // ==================== GLOBAL VARIABLES ====================
    let allOrders = [];
    let allCustomers = new Map();
    let currentVerificationOrder = null;
    let currentStatusOrder = null;
    let currentCustomerView = null;
    let broadcastChannel = null;
    let activityChannel = null;
    let audioCtx = null;

    // ==================== INITIALIZE AUDIO ====================
    function initAudio() {
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            console.log('Audio not supported');
        }
    }

    function playNotificationSound() {
        if (!audioCtx) return;
        try {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.value = 600;
            gainNode.gain.value = 0.2;
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.2);
        } catch (e) {}
    }

    function playApprovalSound() {
        if (!audioCtx) return;
        try {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.value = 800;
            gainNode.gain.value = 0.3;
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            setTimeout(() => {
                oscillator.frequency.value = 1000;
            }, 150);
            oscillator.stop(audioCtx.currentTime + 0.3);
        } catch (e) {}
    }

    // ==================== LOAD ORDERS FROM FIREBASE ====================
    function loadOrdersFromFirebase() {
        console.log(' Loading orders from Firebase...');
        
        database.ref('orders').on('value', (snapshot) => {
            const data = snapshot.val();
            
            if (!data) {
                allOrders = [];
                updateAllDisplays();
                return;
            }
            
            allOrders = Object.keys(data).map(key => ({
                ...data[key],
                firebaseKey: key
            }));
            
            console.log(` Loaded ${allOrders.length} orders`);
            processCustomers();
            updateAllDisplays();
            checkForNewOrders();
        });
    }

    // ==================== PROCESS CUSTOMERS ====================
    function processCustomers() {
        allCustomers.clear();
        
        allOrders.forEach(order => {
            if (!order.customerPhone) return;
            
            const key = `${order.customerPhone}`;
            
            if (!allCustomers.has(key)) {
                allCustomers.set(key, {
                    name: order.customerName || 'Unknown',
                    phone: order.customerPhone,
                    email: order.customerEmail || 'N/A',
                    totalOrders: 0,
                    totalSpent: 0,
                    orders: [],
                    lastOrder: null
                });
            }
            
            const customer = allCustomers.get(key);
            customer.totalOrders++;
            customer.totalSpent += order.total || order.totalAmount || 0;
            customer.orders.push({
                id: order.id,
                date: order.createdAt || order.timestamp,
                amount: order.total || order.totalAmount,
                status: order.status,
                paymentStatus: order.paymentStatus
            });
            
            const orderDate = new Date(order.createdAt || order.timestamp || 0);
            if (!customer.lastOrder || orderDate > new Date(customer.lastOrder)) {
                customer.lastOrder = order.createdAt || order.timestamp;
            }
        });
        
        console.log(` Processed ${allCustomers.size} customers`);
    }

    // ==================== CHECK FOR NEW ORDERS ====================
    let lastOrderCount = 0;
    
    function checkForNewOrders() {
        if (allOrders.length > lastOrderCount) {
            const newOrders = allOrders.slice(lastOrderCount);
            newOrders.forEach(order => {
                if (order.paymentStatus === 'pending' && order.status === 'pending-payment') {
                    playNotificationSound();
                    showNotification(` New order from ${order.customerName || 'Customer'}`, 'warning');
                    
                    addActivity({
                        type: 'order_created',
                        message: ` New order ${order.id.slice(-8)} from ${order.customerName || 'Customer'}`,
                        orderId: order.id,
                        customerName: order.customerName,
                        icon: 'fa-cart-plus',
                        color: '#9b59b6'
                    });
                }
            });
        }
        lastOrderCount = allOrders.length;
    }

    // ==================== UPDATE ALL DISPLAYS ====================
    function updateAllDisplays() {
        // Add safety checks to prevent errors when elements don't exist yet
        if (!document.getElementById('totalRevenue')) {
            console.log(' Dashboard elements not ready yet, skipping update');
            return;
        }
        
        updateStats();
        updateVerificationQueue();
        updateVerifiedOrders();
        updateCancelledOrders();
        updateCustomersDisplay();
        updateActivityFeed();
        updateSidebarBadges();
    }

    // ==================== UPDATE STATS ====================
    function updateStats() {
        // Safety check
        if (!document.getElementById('totalRevenue')) return;
        
        const verifiedRevenue = allOrders
            .filter(o => o.paymentStatus === 'verified')
            .reduce((sum, o) => sum + (o.total || o.totalAmount || 0), 0);
        
        const pendingCount = allOrders.filter(o => 
            o.paymentStatus === 'pending' && o.status !== 'cancelled'
        ).length;
        
        const verifiedCount = allOrders.filter(o => 
            o.paymentStatus === 'verified' && o.status !== 'cancelled'
        ).length;
        
        const customersCount = allCustomers.size;
        
        document.getElementById('totalRevenue').textContent = `${verifiedRevenue.toLocaleString()}`;
        document.getElementById('awaitingVerification').textContent = pendingCount;
        document.getElementById('verifiedOrdersCount').textContent = verifiedCount;
        document.getElementById('totalCustomers').textContent = customersCount;
    }

    // ==================== UPDATE SIDEBAR BADGES ====================
    function updateSidebarBadges() {
        // Safety check
        if (!document.getElementById('verificationBadge')) return;
        
        const pendingCount = allOrders.filter(o => 
            o.paymentStatus === 'pending' && o.status !== 'cancelled'
        ).length;
        
        const verifiedCount = allOrders.filter(o => 
            o.paymentStatus === 'verified' && o.status !== 'cancelled'
        ).length;
        
        const cancelledCount = allOrders.filter(o => 
            o.status === 'cancelled'
        ).length;
        
        document.getElementById('verificationBadge').textContent = pendingCount;
        document.getElementById('verifiedBadge').textContent = verifiedCount;
        document.getElementById('cancelledBadge').textContent = cancelledCount;
        
        const paymentNotice = document.getElementById('paymentNotice');
        if (paymentNotice) {
            if (pendingCount > 0) {
                paymentNotice.style.display = 'flex';
                document.getElementById('paymentNoticeMessage').textContent = 
                    `${pendingCount} order${pendingCount > 1 ? 's' : ''} pending verification`;
                document.getElementById('paymentNoticeCount').innerHTML = 
                    `<i class="fas fa-clock"></i> ${pendingCount} pending`;
            } else {
                paymentNotice.style.display = 'none';
            }
        }
    }

    // ==================== UPDATE VERIFICATION QUEUE ====================
    function updateVerificationQueue() {
        const container = document.getElementById('verificationList');
        if (!container) return;
        
        const pendingOrders = allOrders.filter(o => 
            o.paymentStatus === 'pending' && 
            o.status !== 'cancelled'
        ).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        if (pendingOrders.length === 0) {
            container.innerHTML = `
                <div class="empty-queue">
                    <i class="fas fa-check-circle"></i>
                    <p>No payments pending verification</p>
                    <span style="color: var(--gray);">All caught up!</span>
                </div>
            `;
            return;
        }
        
        container.innerHTML = pendingOrders.map(order => `
            <div class="verification-card" data-order-id="${order.id}">
                <div class="verification-card-header">
                    <span class="verification-order-id">${order.id}</span>
                    <span class="verification-time">
                        <i class="far fa-clock"></i> ${timeAgo(order.createdAt)}
                    </span>
                </div>
                
                <div class="verification-customer">
                    <div class="customer-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="customer-details">
                        <h4>${order.customerName || 'Customer'}</h4>
                        <p><i class="fas fa-phone-alt"></i> ${order.customerPhone || 'N/A'}</p>
                    </div>
                </div>
                
                <div class="verification-items">
                    ${order.items?.map(item => `
                        <div class="verification-item-row">
                            <span class="item-name">${item.name}</span>
                            <span class="item-quantity">x${item.quantity}</span>
                            <span class="item-price">${(item.price * item.quantity).toLocaleString()}</span>
                        </div>
                    `).join('') || '<div>No items</div>'}
                </div>
                
                <div class="verification-footer">
                    <span class="verification-amount">${(order.total || order.totalAmount || 0).toLocaleString()}</span>
                    <div class="verification-actions">
                        <button class="btn-verify" onclick="openVerifyModal('${order.id}')">
                            <i class="fas fa-check"></i> Verify
                        </button>
                        <button class="btn-reject" onclick="openRejectModal('${order.id}')">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // ==================== UPDATE VERIFIED ORDERS ====================
    function updateVerifiedOrders() {
        const container = document.getElementById('verifiedOrdersList');
        if (!container) return;
        
        const verifiedOrders = allOrders.filter(o => 
            o.paymentStatus === 'verified' && 
            o.status !== 'cancelled'
        ).sort((a, b) => new Date(b.verifiedAt || b.createdAt) - new Date(a.verifiedAt || a.createdAt));
        
        if (verifiedOrders.length === 0) {
            container.innerHTML = `
                <div class="empty-queue">
                    <i class="fas fa-shopping-cart"></i>
                    <p>No verified orders yet</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = verifiedOrders.map(order => renderOrderCard(order, 'verified')).join('');
    }

    // ==================== UPDATE CANCELLED ORDERS ====================
    function updateCancelledOrders() {
        const container = document.getElementById('cancelledOrdersList');
        if (!container) return;
        
        const cancelledOrders = allOrders.filter(o => 
            o.status === 'cancelled'
        ).sort((a, b) => new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt));
        
        if (cancelledOrders.length === 0) {
            container.innerHTML = `
                <div class="empty-queue">
                    <i class="fas fa-times-circle"></i>
                    <p>No cancelled orders</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = cancelledOrders.map(order => renderOrderCard(order, 'cancelled')).join('');
    }

    // ==================== RENDER ORDER CARD ====================
    function renderOrderCard(order, type) {
        const cardClass = type === 'verified' ? 'verified-card' : 'cancelled-card';
        const statusText = order.status?.replace('-', ' ') || 'pending';
        
        let progressHtml = '';
        if (type === 'verified' && order.status !== 'cancelled' && order.status !== 'completed') {
            progressHtml = renderTimeline(order);
        }
        
        return `
            <div class="order-card ${cardClass}" data-order-id="${order.id}">
                <div class="order-card-header">
                    <div class="order-badge">
                        <span class="order-id-badge">${order.id}</span>
                        <span class="status-badge ${order.status || 'pending'}">
                            <i class="fas ${getStatusIcon(order.status)}"></i> ${statusText}
                        </span>
                    </div>
                    <span class="order-time">
                        <i class="far fa-clock"></i> ${timeAgo(order.createdAt)}
                    </span>
                </div>

                <div class="order-customer-row">
                    <div class="customer-avatar-large">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="customer-info-detailed">
                        <h4>${order.customerName || 'Customer'}</h4>
                        <div class="customer-contact">
                            <span><i class="fas fa-phone-alt"></i> ${order.customerPhone || 'N/A'}</span>
                            <span><i class="fas fa-envelope"></i> ${order.customerEmail || 'N/A'}</span>
                        </div>
                    </div>
                </div>

                <div class="order-items-list">
                    ${order.items?.map(item => `
                        <div class="order-item-row">
                            <div class="item-info">
                                <span class="item-quantity-badge">${item.quantity}x</span>
                                <span class="item-name">${item.name}</span>
                            </div>
                            <span class="item-price">${(item.price * item.quantity).toLocaleString()}</span>
                        </div>
                    `).join('') || '<div>No items</div>'}
                </div>

                ${progressHtml}

                <div class="order-footer">
                    <div class="order-total">
                        <span class="total-label">Total Amount</span>
                        <span class="total-amount">${(order.total || order.totalAmount || 0).toLocaleString()}</span>
                    </div>
                    <div class="order-actions">
                        ${type === 'verified' ? `
                            ${order.status === 'ready' ? `
                                <button class="btn-action complete" onclick="completeOrderManually('${order.id}')">
                                    <i class="fas fa-flag-checkered"></i> Complete
                                </button>
                            ` : ''}
                            <button class="btn-action update" onclick="openStatusModal('${order.id}')">
                                <i class="fas fa-edit"></i> Update
                            </button>
                        ` : `
                            <span style="color: var(--gray); font-size: 12px;">No actions</span>
                        `}
                    </div>
                </div>
            </div>
        `;
    }

    // ==================== RENDER TIMELINE ====================
    function renderTimeline(order) {
        const steps = ['verified', 'preparing', 'incubating', 'ready'];
        const currentIndex = steps.indexOf(order.status);
        
        let incubationHtml = '';
        if (order.status === 'incubating' && order.incubatingStarted) {
            const start = new Date(order.incubatingStarted);
            const now = new Date();
            const elapsed = now - start;
            const total = 24 * 60 * 60 * 1000;
            const percent = Math.min(100, Math.round((elapsed / total) * 100));
            const remaining = Math.max(0, Math.round((total - elapsed) / (60 * 60 * 1000)));
            
            incubationHtml = `
                <div class="incubation-timer">
                    <div class="timer-info">
                        <i class="fas fa-hourglass-half"></i>
                        <div class="timer-text">
                            <span>Time remaining</span>
                            <strong>${remaining}h</strong>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percent}%;"></div>
                    </div>
                </div>
            `;
        } else if (order.status === 'ready') {
            incubationHtml = `
                <div class="incubation-timer" style="background: var(--success-light);">
                    <div class="timer-info">
                        <i class="fas fa-check-circle" style="color: var(--success);"></i>
                        <div class="timer-text">
                            <span>Ready for pickup</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        return `
            <div class="order-timeline">
                <div class="timeline-header">
                    <span><i class="fas fa-clock"></i> Order Progress</span>
                </div>
                <div class="timeline-steps">
                    ${steps.map((step, index) => `
                        <div class="timeline-step">
                            <div class="step-icon ${index < currentIndex ? 'completed' : index === currentIndex ? 'active' : ''}">
                                <i class="fas ${getStepIcon(step)}"></i>
                            </div>
                            <span class="step-label ${index < currentIndex ? 'completed' : index === currentIndex ? 'active' : ''}">
                                ${step.charAt(0).toUpperCase() + step.slice(1)}
                            </span>
                        </div>
                    `).join('')}
                </div>
                ${incubationHtml}
            </div>
        `;
    }

    function getStepIcon(step) {
        const icons = {
            'verified': 'fa-check',
            'preparing': 'fa-utensils',
            'incubating': 'fa-fire',
            'ready': 'fa-check-circle'
        };
        return icons[step] || 'fa-circle';
    }

    // ==================== UPDATE CUSTOMERS DISPLAY ====================
    function updateCustomersDisplay() {
        const container = document.getElementById('customersList');
        if (!container) return;
        
        if (allCustomers.size === 0) {
            container.innerHTML = `
                <div class="empty-queue">
                    <i class="fas fa-users"></i>
                    <p>No customers yet</p>
                </div>
            `;
            return;
        }
        
        const customersArray = Array.from(allCustomers.values())
            .sort((a, b) => b.totalOrders - a.totalOrders);
        
        container.innerHTML = customersArray.map(customer => `
            <div class="customer-card" data-phone="${customer.phone}">
                <div class="customer-card-header">
                    <div class="customer-avatar-lg">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="customer-title">
                        <h4>${customer.name}</h4>
                        <p><i class="fas fa-phone-alt"></i> ${customer.phone}</p>
                    </div>
                </div>
                
                <div class="customer-stats-grid">
                    <div class="customer-stat-item">
                        <div class="customer-stat-value">${customer.totalOrders}</div>
                        <div class="customer-stat-label">Orders</div>
                    </div>
                    <div class="customer-stat-item">
                        <div class="customer-stat-value">${(customer.totalSpent / 1000).toFixed(1)}k</div>
                        <div class="customer-stat-label">Spent</div>
                    </div>
                    <div class="customer-stat-item">
                        <div class="customer-stat-value">${customer.orders.length}</div>
                        <div class="customer-stat-label">Items</div>
                    </div>
                </div>
                
                <div class="customer-contact-info">
                    <div class="contact-row">
                        <i class="fas fa-envelope"></i>
                        <span>${customer.email}</span>
                    </div>
                    <div class="contact-row">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Last order: ${customer.lastOrder ? new Date(customer.lastOrder).toLocaleDateString() : 'N/A'}</span>
                    </div>
                </div>
                
                <div class="customer-orders-preview">
                    <div class="preview-header">
                        <span>Recent Orders</span>
                        <span>${customer.orders.length} total</span>
                    </div>
                    ${customer.orders.slice(0, 3).map(order => `
                        <div class="preview-order-item">
                            <span class="preview-order-id">${order.id.slice(-8)}</span>
                            <span class="preview-order-status ${order.status}" 
                                  style="background: ${getStatusColor(order.status)}20; color: ${getStatusColor(order.status)};">
                                ${order.status || 'pending'}
                            </span>
                            <span>${(order.amount || 0).toLocaleString()}</span>
                        </div>
                    `).join('')}
                </div>
                
                <button class="view-customer-btn" onclick="viewCustomerDetails('${customer.phone}')">
                    <i class="fas fa-eye"></i> View Full History
                </button>
            </div>
        `).join('');
    }

// ==================== AUTO PROGRESS CHECKER (STOPS AT READY) ====================
function checkOrderProgressions() {
    console.log(' Checking order progressions in Firebase...');
    
    // Get orders DIRECTLY from Firebase (not localStorage)
    database.ref('orders').once('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) {
            console.log('No orders found');
            return;
        }
        
        const now = new Date();
        let updates = [];
        
        // Convert Firebase object to array
        const orders = Object.entries(data).map(([key, order]) => ({
            ...order,
            firebaseKey: key
        }));
        
        orders.forEach(order => {
            // Only process verified orders
            if (order.paymentStatus !== 'verified') return;
            
            // Skip if already ready or completed
            if (order.status === 'ready' || order.status === 'completed') return;
            
            // =============================================
            // STAGE 1: Preparing  Incubating (30 minutes)
            // =============================================
            if (order.status === 'preparing') {
                const stageStartTime = new Date(order.preparingStarted || order.verifiedAt || order.updatedAt);
                
                // Skip if invalid date
                if (isNaN(stageStartTime)) {
                    console.warn(`Invalid date for order ${order.id}`);
                    return;
                }
                
                const timeElapsed = now - stageStartTime;
                const elapsedMinutes = Math.floor(timeElapsed / (60 * 1000));
                
                console.log(`Order ${order.id.slice(-8)}: Preparing for ${elapsedMinutes} minutes`);
                
                if (timeElapsed >= 30 * 60 * 1000) { // 30 minutes
                    console.log(` Auto-progress: Order ${order.id} preparing  incubating`);
                    
                    const updateData = {
                        status: 'incubating',
                        incubatingStarted: now.toISOString(),
                        updatedAt: now.toISOString()
                    };
                    
                    // Update Firebase
                    updates.push(
                        database.ref(`orders/${order.firebaseKey}`).update(updateData)
                            .then(() => {
                                const message = ` Order ${order.id.slice(-8)} moved to incubating (23hr countdown started)`;
                                
                                // Add to activity feed
                                addActivityToFeed({
                                    type: 'status_change',
                                    message: message,
                                    orderId: order.id,
                                    customerName: order.customerName,
                                    timestamp: now.toISOString(),
                                    icon: 'fa-clock',
                                    color: '#f39c12'
                                });
                                
                                broadcastToOrderPage('status_change', message, order.id, order.customerName);
                                console.log(` Order ${order.id.slice(-8)} now incubating`);
                            })
                            .catch(err => console.error('Firebase error:', err))
                    );
                }
            }
            
            // =============================================
            // STAGE 2: Incubating  Ready (23 hours)
            // =============================================
            else if (order.status === 'incubating') {
                const stageStartTime = new Date(order.incubatingStarted || order.updatedAt);
                
                // Skip if invalid date
                if (isNaN(stageStartTime)) {
                    console.warn(`Invalid date for order ${order.id}`);
                    return;
                }
                
                const timeElapsed = now - stageStartTime;
                const elapsedHours = Math.floor(timeElapsed / (60 * 60 * 1000));
                
                console.log(`Order ${order.id.slice(-8)}: Incubating for ${elapsedHours} hours`);
                
                if (timeElapsed >= 23 * 60 * 60 * 1000) { // 23 hours
                    console.log(` Auto-progress: Order ${order.id} incubating  READY`);
                    
                    const updateData = {
                        status: 'ready',
                        readyAt: now.toISOString(),
                        updatedAt: now.toISOString()
                    };
                    
                    // Update Firebase
                    updates.push(
                        database.ref(`orders/${order.firebaseKey}`).update(updateData)
                            .then(() => {
                                const message = ` Order ${order.id.slice(-8)} is READY for pickup`;
                                
                                addActivityToFeed({
                                    type: 'status_change',
                                    message: message,
                                    orderId: order.id,
                                    customerName: order.customerName,
                                    timestamp: now.toISOString(),
                                    icon: 'fa-check-circle',
                                    color: '#2ecc71'
                                });
                                
                                broadcastToOrderPage('status_change', message, order.id, order.customerName);
                                console.log(` Order ${order.id.slice(-8)} is now READY`);
                            })
                            .catch(err => console.error('Firebase error:', err))
                    );
                }
            }
        });
        
        // Wait for all updates
        Promise.all(updates).then(() => {
            if (updates.length > 0) {
                console.log(` Completed ${updates.length} auto-progressions`);
                
                // Reload orders from Firebase to refresh dashboard
                loadOrdersFromFirebase();
            }
        });
        
    }).catch(error => {
        console.error(' Error checking progressions:', error);
    });
}

// Start auto-progression checker (runs every minute)
setInterval(checkOrderProgressions, 60 * 1000);

    // ==================== MANUAL UPDATE STATUS (ADMIN CLICK) ====================
    window.updateOrderStatus = function() {
        console.log(' Manual status update started');
        
        if (!currentStatusOrder) {
            showNotification('No order selected', 'error');
            return;
        }
        
        const selectedStatus = document.querySelector('input[name="status"]:checked');
        if (!selectedStatus) {
            showNotification('Please select a status', 'warning');
            return;
        }
        
        const newStatus = selectedStatus.value;
        const order = allOrders.find(o => o.id === currentStatusOrder);
        
        if (!order || !order.firebaseKey) {
            showNotification('Order not found', 'error');
            closeModal('statusModal');
            return;
        }
        
        const updateBtn = document.getElementById('confirmUpdate');
        const originalText = updateBtn.innerHTML;
        updateBtn.disabled = true;
        updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
        
        // Prepare updates
        const updates = {
            status: newStatus,
            updatedAt: new Date().toISOString()
        };
        
        // Add stage-specific timestamps
        if (newStatus === 'preparing' && !order.preparingStarted) {
            updates.preparingStarted = new Date().toISOString();
        }
        if (newStatus === 'incubating' && !order.incubatingStarted) {
            updates.incubatingStarted = new Date().toISOString();
        }
        if (newStatus === 'ready' && !order.readyAt) {
            updates.readyAt = new Date().toISOString();
        }
        if (newStatus === 'completed') {
            updates.completedAt = new Date().toISOString();
            updates.completedBy = 'admin';
        }
        
        // Timeout protection
        const timeout = setTimeout(() => {
            updateBtn.disabled = false;
            updateBtn.innerHTML = originalText;
            showNotification('Update timed out', 'warning');
        }, 5000);
        
        //  UPDATE FIREBASE (triggers live sync to order page)
        database.ref(`orders/${order.firebaseKey}`).update(updates)
        .then(() => {
            clearTimeout(timeout);
            
            // Update local array
            Object.assign(order, updates);
            
            // Play sound
            if (window.playApprovalSound) window.playApprovalSound();
            
            // Create message
            let message = '';
            if (newStatus === 'preparing') message = ` Order ${order.id.slice(-8)} started preparation (manual)`;
            if (newStatus === 'incubating') message = ` Order ${order.id.slice(-8)} moved to incubating (manual)`;
            if (newStatus === 'ready') message = ` Order ${order.id.slice(-8)} is READY for pickup (manual)`;
            if (newStatus === 'completed') message = ` Order ${order.id.slice(-8)} completed by admin`;
            
            if (message) {
                // Add to admin activity feed
                addActivityToFeed({
                    type: 'status_change',
                    message: message,
                    orderId: order.id,
                    customerName: order.customerName,
                    timestamp: new Date().toISOString(),
                    icon: 'fa-sync-alt',
                    color: '#3498db'
                });
                
                //  BROADCAST to order page
                broadcastToOrderPage('status_change', message, order.id, order.customerName);
            }
            
            showNotification(`Order manually updated to ${newStatus}`, 'success');
            closeModal('statusModal');
            currentStatusOrder = null;
            
            updateBtn.disabled = false;
            updateBtn.innerHTML = originalText;
            
            // Refresh dashboard
            loadDashboardData();
        })
        .catch(error => {
            clearTimeout(timeout);
            console.error(' Error:', error);
            showNotification('Error updating status: ' + error.message, 'error');
            updateBtn.disabled = false;
            updateBtn.innerHTML = originalText;
        });
    };

    // ==================== MANUAL COMPLETE ORDER ====================
    window.completeOrderManually = function(orderId) {
        console.log(' Admin manually completing order:', orderId);
        
        const order = allOrders.find(o => o.id === orderId);
        if (!order || !order.firebaseKey) {
            showNotification('Order not found', 'error');
            return;
        }
        
        // Confirm with admin
        if (!confirm(`Mark order ${orderId.slice(-8)} as COMPLETED?`)) {
            return;
        }
        
        const completeBtn = event?.target;
        const originalText = completeBtn?.innerHTML;
        if (completeBtn) {
            completeBtn.disabled = true;
            completeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        }
        
        const timeout = setTimeout(() => {
            if (completeBtn) {
                completeBtn.disabled = false;
                completeBtn.innerHTML = originalText;
            }
            showNotification('Completion timed out', 'warning');
        }, 5000);
        
        //  UPDATE FIREBASE
        database.ref(`orders/${order.firebaseKey}`).update({
            status: 'completed',
            completedAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            completedBy: 'admin'
        })
        .then(() => {
            clearTimeout(timeout);
            
            // Update local array
            order.status = 'completed';
            order.completedAt = new Date().toISOString();
            
            if (window.playApprovalSound) window.playApprovalSound();
            
            const message = ` Order ${orderId.slice(-8)} completed by admin`;
            
            // Add to admin feed
            addActivityToFeed({
                type: 'order_completed',
                message: message,
                orderId: order.id,
                customerName: order.customerName,
                timestamp: new Date().toISOString(),
                icon: 'fa-flag-checkered',
                color: '#3498db'
            });
            
            //  BROADCAST to order page
            broadcastToOrderPage('order_completed', message, order.id, order.customerName);
            
            showNotification(` Order completed`, 'success');
            
            if (completeBtn) {
                completeBtn.disabled = false;
                completeBtn.innerHTML = originalText;
            }
            
            // Refresh dashboard
            loadDashboardData();
        })
        .catch(error => {
            clearTimeout(timeout);
            console.error(' Error:', error);
            showNotification('Error completing order: ' + error.message, 'error');
            if (completeBtn) {
                completeBtn.disabled = false;
                completeBtn.innerHTML = originalText;
            }
        });
    };

    // ==================== BROADCAST TO ORDER PAGE ====================
    function broadcastToOrderPage(type, message, orderId, customerName) {
        const activity = {
            id: Date.now() + Math.random(),
            type: type,
            message: message,
            orderId: orderId,
            customerName: customerName,
            timestamp: new Date().toISOString(),
            icon: getBroadcastIcon(type),
            color: getBroadcastColor(type)
        };
        
        console.log(' BROADCASTING to Order Page:', message);
        
        // Method 1: BroadcastChannel
        if (window.broadcastChannel) {
            try {
                window.broadcastChannel.postMessage({
                    type: 'NEW_ACTIVITY',
                    activity: activity
                });
            } catch (e) {}
        }
        
        // Method 2: Create new channel if needed
        if (typeof BroadcastChannel !== 'undefined') {
            try {
                const channel = new BroadcastChannel('cleanbite_activities');
                channel.postMessage({
                    type: 'NEW_ACTIVITY',
                    activity: activity
                });
                setTimeout(() => channel.close(), 100);
            } catch (e) {}
        }
        
        // Method 3: localStorage fallback
        try {
            localStorage.setItem('cleanbite_broadcast', JSON.stringify({
                type: 'ACTIVITY',
                activity: activity,
                timestamp: Date.now()
            }));
            setTimeout(() => localStorage.removeItem('cleanbite_broadcast'), 100);
        } catch (e) {}
    }

    // Initialize broadcast channel
    if (typeof BroadcastChannel !== 'undefined') {
        try {
            window.broadcastChannel = new BroadcastChannel('cleanbite_activities');
            console.log(' Broadcast channel initialized');
        } catch (e) {
            console.error(' Broadcast channel error:', e);
        }
    }

    // ==================== ADD ACTIVITY TO FEED ====================
    function addActivityToFeed(activity) {
        const feed = document.getElementById('activityFeed');
        if (!feed) return;
        
        const el = document.createElement('div');
        el.className = 'activity-item';
        el.style.borderLeftColor = activity.color || '#3498db';
        el.innerHTML = `
            <div class="activity-icon" style="color: ${activity.color || '#3498db'};">
                <i class="fas ${activity.icon || 'fa-bell'}"></i>
            </div>
            <div class="activity-content">
                <div class="activity-message">${activity.message}</div>
                <div class="activity-time">
                    <i class="far fa-clock"></i> Just now
                    ${activity.customerName ? `
                        <span class="activity-customer">
                            <i class="fas fa-user"></i> ${activity.customerName}
                        </span>
                    ` : ''}
                    ${activity.orderId ? `
                        <span class="activity-order">
                            <i class="fas fa-hashtag"></i> ${activity.orderId.slice(-8)}
                        </span>
                    ` : ''}
                </div>
            </div>
        `;
        
        if (feed.firstChild) {
            feed.insertBefore(el, feed.firstChild);
        } else {
            feed.appendChild(el);
        }
        
        while (feed.children.length > 30) {
            feed.removeChild(feed.lastChild);
        }
    }

    // ==================== UPDATE ACTIVITY FEED ====================
    function updateActivityFeed() {
        const feed = document.getElementById('activityFeed');
        if (!feed) return;
        
        const activities = allOrders
            .flatMap(order => {
                const acts = [];
                if (order.verifiedAt) {
                    acts.push({
                        type: 'payment_verified',
                        message: ` Payment verified for order ${order.id.slice(-8)}`,
                        orderId: order.id,
                        customerName: order.customerName,
                        timestamp: order.verifiedAt,
                        icon: 'fa-check-circle',
                        color: '#2ecc71'
                    });
                }
                if (order.updatedAt && order.status) {
                    let message = '';
                    if (order.status === 'preparing') 
                        message = ` Order ${order.id.slice(-8)} started preparation`;
                    if (order.status === 'incubating') 
                        message = ` Order ${order.id.slice(-8)} moved to incubating`;
                    if (order.status === 'ready') 
                        message = ` Order ${order.id.slice(-8)} is READY`;
                    if (order.status === 'completed') 
                        message = ` Order ${order.id.slice(-8)} completed`;
                    
                    if (message) {
                        acts.push({
                            type: 'status_change',
                            message: message,
                            orderId: order.id,
                            customerName: order.customerName,
                            timestamp: order.updatedAt,
                            icon: 'fa-sync-alt',
                            color: '#3498db'
                        });
                    }
                }
                if (order.createdAt && !order.verifiedAt && order.status !== 'cancelled') {
                    acts.push({
                        type: 'order_created',
                        message: ` New order ${order.id.slice(-8)} from ${order.customerName || 'Customer'}`,
                        orderId: order.id,
                        customerName: order.customerName,
                        timestamp: order.createdAt,
                        icon: 'fa-cart-plus',
                        color: '#9b59b6'
                    });
                }
                return acts;
            })
            .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
            .slice(0, 30);
        
        if (activities.length === 0) {
            feed.innerHTML = `
                <div class="empty-queue">
                    <i class="fas fa-stream"></i>
                    <p>No recent activity</p>
                </div>
            `;
            return;
        }
        
        feed.innerHTML = activities.map(act => `
            <div class="activity-item" style="border-left-color: ${act.color};">
                <div class="activity-icon" style="color: ${act.color};">
                    <i class="fas ${act.icon}"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-message">${act.message}</div>
                    <div class="activity-time">
                        <i class="far fa-clock"></i> ${timeAgo(act.timestamp)}
                        ${act.customerName ? `
                            <span class="activity-customer">
                                <i class="fas fa-user"></i> ${act.customerName}
                            </span>
                        ` : ''}
                        ${act.orderId ? `
                            <span class="activity-order">
                                <i class="fas fa-hashtag"></i> ${act.orderId.slice(-8)}
                            </span>
                        ` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // ==================== TIME AGO HELPER ====================
    function timeAgo(timestamp) {
        if (!timestamp) return 'Just now';
        const diff = Math.floor((new Date() - new Date(timestamp)) / 60000);
        if (diff < 1) return 'Just now';
        if (diff < 60) return `${diff}m ago`;
        if (diff < 1440) return `${Math.floor(diff / 60)}h ago`;
        return `${Math.floor(diff / 1440)}d ago`;
    }

    // ==================== GET STATUS COLOR ====================
    function getStatusColor(status) {
        const colors = {
            'pending-payment': '#f39c12',
            'preparing': '#3498db',
            'incubating': '#9b59b6',
            'ready': '#2ecc71',
            'completed': '#95a5a6',
            'cancelled': '#e74c3c'
        };
        return colors[status] || '#95a5a6';
    }

    function getStatusIcon(status) {
        const icons = {
            'pending-payment': 'fa-clock',
            'preparing': 'fa-utensils',
            'incubating': 'fa-clock',
            'ready': 'fa-check-circle',
            'completed': 'fa-flag-checkered',
            'cancelled': 'fa-ban'
        };
        return icons[status] || 'fa-circle';
    }

    // ==================== BROADCAST SYSTEM ====================
    function initBroadcastSystem() {
        try {
            if (typeof BroadcastChannel !== 'undefined') {
                broadcastChannel = new BroadcastChannel('cleanbite_activities');
                activityChannel = new BroadcastChannel('cleanbite_admin');
            }
        } catch (e) {}
    }

    function getBroadcastIcon(type) {
        const icons = {
            'payment_verified': 'fa-check-circle',
            'payment_rejected': 'fa-times-circle',
            'order_created': 'fa-cart-plus',
            'status_change': 'fa-sync-alt',
            'order_completed': 'fa-flag-checkered'
        };
        return icons[type] || 'fa-bell';
    }

    function getBroadcastColor(type) {
        const colors = {
            'payment_verified': '#2ecc71',
            'payment_rejected': '#e74c3c',
            'order_created': '#9b59b6',
            'status_change': '#3498db',
            'order_completed': '#3498db'
        };
        return colors[type] || '#95a5a6';
    }

    function addActivity(activity) {
        const feed = document.getElementById('activityFeed');
        if (!feed) return;
        
        const el = document.createElement('div');
        el.className = 'activity-item';
        el.style.borderLeftColor = activity.color || '#3498db';
        el.innerHTML = `
            <div class="activity-icon" style="color: ${activity.color || '#3498db'};">
                <i class="fas ${activity.icon || 'fa-bell'}"></i>
            </div>
            <div class="activity-content">
                <div class="activity-message">${activity.message}</div>
                <div class="activity-time">
                    <i class="far fa-clock"></i> Just now
                    ${activity.customerName ? `
                        <span class="activity-customer">
                            <i class="fas fa-user"></i> ${activity.customerName}
                        </span>
                    ` : ''}
                    ${activity.orderId ? `
                        <span class="activity-order">
                            <i class="fas fa-hashtag"></i> ${activity.orderId.slice(-8)}
                        </span>
                    ` : ''}
                </div>
            </div>
        `;
        
        if (feed.firstChild) {
            feed.insertBefore(el, feed.firstChild);
        } else {
            feed.appendChild(el);
        }
        
        while (feed.children.length > 30) {
            feed.removeChild(feed.lastChild);
        }
    }

    // ==================== VERIFY PAYMENT ====================
    window.openVerifyModal = function(orderId) {
        const order = allOrders.find(o => o.id === orderId);
        if (!order) return;
        
        currentVerificationOrder = orderId;
        document.getElementById('verifyOrderId').textContent = order.id;
        document.getElementById('verifyCustomerName').textContent = order.customerName || 'Customer';
        document.getElementById('verifyAmount').textContent = `${(order.total || order.totalAmount || 0).toLocaleString()}`;
        document.getElementById('verifyMethod').textContent = order.paymentMethod || 'Bank Transfer';
        document.getElementById('verificationNotes').value = '';
        document.getElementById('verifyModal').classList.add('active');
    };

    document.getElementById('confirmVerification')?.addEventListener('click', function() {
        const btn = this;
        if (!currentVerificationOrder) return;
        
        const order = allOrders.find(o => o.id === currentVerificationOrder);
        if (!order || !order.firebaseKey) {
            showNotification('Order not found', 'error');
            closeModal('verifyModal');
            return;
        }
        
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
        
        const timeout = setTimeout(() => {
            btn.disabled = false;
            btn.innerHTML = originalText;
            showNotification('Verification timed out', 'warning');
        }, 5000);
        
        database.ref(`orders/${order.firebaseKey}`).update({
            paymentStatus: 'verified',
            status: 'preparing',
            verifiedAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            preparingStarted: new Date().toISOString()
        })
        .then(() => {
            clearTimeout(timeout);
            playApprovalSound();
            
            const message = ` Payment verified for order ${order.id.slice(-8)}`;
            addActivity({
                type: 'payment_verified',
                message,
                orderId: order.id,
                customerName: order.customerName,
                icon: 'fa-check-circle',
                color: '#2ecc71'
            });
            
            broadcastToOrderPage('payment_verified', message, order.id, order.customerName);
            showNotification('Payment verified successfully', 'success');
            closeModal('verifyModal');
        })
        .catch(error => {
            clearTimeout(timeout);
            console.error(error);
            showNotification('Error verifying payment', 'error');
            btn.disabled = false;
            btn.innerHTML = originalText;
        });
    });

    // ==================== REJECT PAYMENT ====================
    window.openRejectModal = function(orderId) {
        const order = allOrders.find(o => o.id === orderId);
        if (!order) return;
        
        currentVerificationOrder = orderId;
        document.getElementById('rejectOrderId').textContent = order.id;
        document.getElementById('rejectCustomerName').textContent = order.customerName || 'Customer';
        document.getElementById('rejectAmount').textContent = `${(order.total || order.totalAmount || 0).toLocaleString()}`;
        document.getElementById('rejectionReason').value = '';
        document.getElementById('rejectModal').classList.add('active');
    };

    document.getElementById('confirmRejection')?.addEventListener('click', function() {
        const btn = this;
        if (!currentVerificationOrder) return;
        
        const reason = document.getElementById('rejectionReason').value.trim();
        if (!reason) {
            showNotification('Please provide a rejection reason', 'warning');
            return;
        }
        
        const order = allOrders.find(o => o.id === currentVerificationOrder);
        if (!order || !order.firebaseKey) {
            showNotification('Order not found', 'error');
            closeModal('rejectModal');
            return;
        }
        
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Rejecting...';
        
        const timeout = setTimeout(() => {
            btn.disabled = false;
            btn.innerHTML = originalText;
            showNotification('Rejection timed out', 'warning');
        }, 5000);
        
        database.ref(`orders/${order.firebaseKey}`).update({
            paymentStatus: 'rejected',
            status: 'cancelled',
            rejectionReason: reason,
            rejectedAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        })
        .then(() => {
            clearTimeout(timeout);
            
            const message = ` Payment rejected for order ${order.id.slice(-8)}`;
            addActivity({
                type: 'payment_rejected',
                message,
                orderId: order.id,
                customerName: order.customerName,
                icon: 'fa-times-circle',
                color: '#e74c3c'
            });
            
            broadcastToOrderPage('payment_rejected', message, order.id, order.customerName);
            showNotification('Payment rejected', 'warning');
            closeModal('rejectModal');
        })
        .catch(error => {
            clearTimeout(timeout);
            console.error(error);
            showNotification('Error rejecting payment', 'error');
            btn.disabled = false;
            btn.innerHTML = originalText;
        });
    });

    // ==================== UPDATE STATUS ====================
    window.openStatusModal = function(orderId) {
        const order = allOrders.find(o => o.id === orderId);
        if (!order) return;
        
        currentStatusOrder = orderId;
        document.getElementById('statusOrderId').textContent = order.id;
        document.getElementById('statusCustomerName').textContent = order.customerName || 'Customer';
        document.getElementById('currentStatus').innerHTML = 
            `<span class="status-badge ${order.status}" style="background: ${getStatusColor(order.status)}20; color: ${getStatusColor(order.status)};">
                ${order.status?.replace('-', ' ') || 'pending'}
            </span>`;
        
        const statuses = ['preparing', 'incubating', 'ready', 'completed'];
        const options = document.getElementById('statusOptions');
        options.innerHTML = statuses.map(status => `
            <label class="status-option" style="background: ${order.status === status ? 'var(--primary-light)' : 'white'};">
                <input type="radio" name="status" value="${status}" ${order.status === status ? 'checked' : ''}>
                <span class="status-badge ${status}" style="background: ${getStatusColor(status)}20; color: ${getStatusColor(status)};">
                    <i class="fas ${getStatusIcon(status)}"></i> ${status}
                </span>
                ${order.status === status ? '<span style="margin-left: auto; color: var(--primary);"><i class="fas fa-check-circle"></i> Current</span>' : ''}
            </label>
        `).join('');
        
        document.getElementById('statusModal').classList.add('active');
    };

    document.getElementById('confirmUpdate')?.addEventListener('click', function() {
        const btn = this;
        if (!currentStatusOrder) return;
        
        const selected = document.querySelector('input[name="status"]:checked');
        if (!selected) {
            showNotification('Please select a status', 'warning');
            return;
        }
        
        const newStatus = selected.value;
        const order = allOrders.find(o => o.id === currentStatusOrder);
        
        if (!order || !order.firebaseKey) {
            showNotification('Order not found', 'error');
            closeModal('statusModal');
            return;
        }
        
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
        
        const updates = {
            status: newStatus,
            updatedAt: new Date().toISOString()
        };
        
        if (newStatus === 'preparing' && !order.preparingStarted) {
            updates.preparingStarted = new Date().toISOString();
        }
        if (newStatus === 'incubating' && !order.incubatingStarted) {
            updates.incubatingStarted = new Date().toISOString();
        }
        if (newStatus === 'ready' && !order.readyAt) {
            updates.readyAt = new Date().toISOString();
        }
        if (newStatus === 'completed') {
            updates.completedAt = new Date().toISOString();
        }
        
        const timeout = setTimeout(() => {
            btn.disabled = false;
            btn.innerHTML = originalText;
            showNotification('Update timed out', 'warning');
        }, 5000);
        
        database.ref(`orders/${order.firebaseKey}`).update(updates)
        .then(() => {
            clearTimeout(timeout);
            playApprovalSound();
            
            let message = '';
            if (newStatus === 'preparing') message = ` Order ${order.id.slice(-8)} started preparation`;
            if (newStatus === 'incubating') message = ` Order ${order.id.slice(-8)} moved to incubating`;
            if (newStatus === 'ready') message = ` Order ${order.id.slice(-8)} is READY`;
            if (newStatus === 'completed') message = ` Order ${order.id.slice(-8)} completed`;
            
            if (message) {
                addActivity({
                    type: 'status_change',
                    message,
                    orderId: order.id,
                    customerName: order.customerName,
                    icon: 'fa-sync-alt',
                    color: '#3498db'
                });
                broadcastToOrderPage('status_change', message, order.id, order.customerName);
            }
            
            showNotification(`Order updated to ${newStatus}`, 'success');
            closeModal('statusModal');
        })
        .catch(error => {
            clearTimeout(timeout);
            console.error(error);
            showNotification('Error updating status', 'error');
            btn.disabled = false;
            btn.innerHTML = originalText;
        });
    });

    // ==================== COMPLETE ORDER ====================
    window.completeOrderManually = function(orderId) {
        const order = allOrders.find(o => o.id === orderId);
        if (!order || !order.firebaseKey) {
            showNotification('Order not found', 'error');
            return;
        }
        
        const timeout = setTimeout(() => {
            showNotification('Completion timed out', 'warning');
        }, 5000);
        
        database.ref(`orders/${order.firebaseKey}`).update({
            status: 'completed',
            completedAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        })
        .then(() => {
            clearTimeout(timeout);
            playApprovalSound();
            
            const message = ` Order ${orderId.slice(-8)} completed`;
            addActivity({
                type: 'order_completed',
                message,
                orderId: order.id,
                customerName: order.customerName,
                icon: 'fa-flag-checkered',
                color: '#3498db'
            });
            broadcastToOrderPage('order_completed', message, order.id, order.customerName);
            showNotification('Order completed', 'success');
        })
        .catch(error => {
            clearTimeout(timeout);
            console.error(error);
            showNotification('Error completing order', 'error');
        });
    };

    // ==================== VIEW CUSTOMER DETAILS ====================
    window.viewCustomerDetails = function(phone) {
        const customer = allCustomers.get(phone);
        if (!customer) return;
        
        const modalBody = document.getElementById('customerModalBody');
        modalBody.innerHTML = `
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="width: 80px; height: 80px; background: var(--primary-light); border-radius: 30px; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                    <i class="fas fa-user-circle" style="font-size: 40px; color: var(--primary);"></i>
                </div>
                <h3 style="font-size: 1.5rem; margin-bottom: 5px;">${customer.name}</h3>
                <p style="color: var(--gray);">${customer.phone}</p>
            </div>
            
            <div class="customer-stats-grid" style="margin-bottom: 25px;">
                <div class="customer-stat-item">
                    <div class="customer-stat-value">${customer.totalOrders}</div>
                    <div class="customer-stat-label">Total Orders</div>
                </div>
                <div class="customer-stat-item">
                    <div class="customer-stat-value">${(customer.totalSpent / 1000).toFixed(1)}k</div>
                    <div class="customer-stat-label">Total Spent</div>
                </div>
                <div class="customer-stat-item">
                    <div class="customer-stat-value">${customer.orders.length}</div>
                    <div class="customer-stat-label">Items</div>
                </div>
            </div>
            
            <div class="customer-contact-info" style="margin-bottom: 25px;">
                <div class="contact-row">
                    <i class="fas fa-envelope"></i>
                    <span>${customer.email}</span>
                </div>
                <div class="contact-row">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Customer since: ${customer.orders.length > 0 ? new Date(customer.orders[customer.orders.length-1].date).toLocaleDateString() : 'N/A'}</span>
                </div>
                <div class="contact-row">
                    <i class="fas fa-clock"></i>
                    <span>Last order: ${customer.lastOrder ? new Date(customer.lastOrder).toLocaleString() : 'N/A'}</span>
                </div>
            </div>
            
            <h4 style="margin-bottom: 15px;">Order History</h4>
            <div style="max-height: 300px; overflow-y: auto;">
                ${customer.orders.sort((a, b) => new Date(b.date) - new Date(a.date)).map(order => `
                    <div style="background: #f8f9fa; border-radius: 16px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 700;">${order.id}</span>
                            <span class="status-badge ${order.status}" style="background: ${getStatusColor(order.status)}20; color: ${getStatusColor(order.status)};">
                                ${order.status || 'pending'}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between; color: var(--gray); font-size: 13px;">
                            <span>${new Date(order.date).toLocaleDateString()}</span>
                            <span style="font-weight: 700; color: var(--success);">${(order.amount || 0).toLocaleString()}</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        
        document.getElementById('customerModal').classList.add('active');
    };

    // ==================== NOTIFICATION ====================
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification-toast ${type}`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'}" 
               style="font-size: 24px; color: ${type === 'success' ? '#2ecc71' : type === 'warning' ? '#f39c12' : '#3498db'};"></i>
            <div style="flex: 1;">
                <div style="font-weight: 700; margin-bottom: 5px;">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                <div style="color: var(--gray);">${message}</div>
            </div>
            <button onclick="this.parentElement.remove()" style="background: none; border: none; color: var(--gray); cursor: pointer; font-size: 20px;">&times;</button>
        `;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 5000);
    }

    // ==================== MODAL FUNCTIONS ====================
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) modal.classList.remove('active');
    }

    // ==================== LOAD DASHBOARD CONTENT ====================
    function loadDashboardContent() {
        const mainContent = document.getElementById('mainContent');
        mainContent.innerHTML = `
            <!-- Payment Notice -->
            <div class="payment-notice" id="paymentNotice">
                <i class="fas fa-exclamation-triangle"></i>
                <div class="payment-notice-content">
                    <h4><i class="fas fa-bell"></i> Payment Verification Required</h4>
                    <p id="paymentNoticeMessage">New orders require payment verification</p>
                </div>
                <span class="badge" id="paymentNoticeCount"><i class="fas fa-clock"></i> 0 pending</span>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card revenue">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-naira-sign"></i></div>
                        <div class="stat-trend positive"><i class="fas fa-arrow-up"></i> Live</div>
                    </div>
                    <div class="stat-value" id="totalRevenue">0</div>
                    <div class="stat-label"><i class="fas fa-circle-check"></i> Verified Revenue</div>
                </div>
                
                <div class="stat-card pending">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                        <div class="stat-trend" id="pendingTrend"><i class="fas fa-clock"></i> 0</div>
                    </div>
                    <div class="stat-value" id="awaitingVerification">0</div>
                    <div class="stat-label"><i class="fas fa-hourglass"></i> Pending Verification</div>
                </div>
                
                <div class="stat-card verified">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-check-double"></i></div>
                        <div class="stat-trend positive"><i class="fas fa-check"></i> Active</div>
                    </div>
                    <div class="stat-value" id="verifiedOrdersCount">0</div>
                    <div class="stat-label"><i class="fas fa-check-circle"></i> Verified Orders</div>
                </div>
                
                <div class="stat-card customers">
                    <div class="stat-header">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-trend positive"><i class="fas fa-arrow-up"></i> Total</div>
                    </div>
                    <div class="stat-value" id="totalCustomers">0</div>
                    <div class="stat-label"><i class="fas fa-user-plus"></i> Active Customers</div>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <span class="filter-label"><i class="fas fa-filter"></i> Filter:</span>
                    <select class="filter-select" id="mainFilter">
                        <option value="all">All Orders</option>
                        <option value="pending">Pending Payment</option>
                        <option value="verified">Verified Only</option>
                        <option value="preparing">Preparing</option>
                        <option value="incubating">Incubating</option>
                        <option value="ready">Ready</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    
                    <select class="filter-select" id="dateFilter">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
                
                <div class="filter-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search orders, customers...">
                </div>
                
                <div class="filter-actions">
                    <button class="filter-btn" id="applyFilter"><i class="fas fa-check"></i> Apply</button>
                    <button class="filter-btn" id="resetFilter"><i class="fas fa-redo-alt"></i> Reset</button>
                </div>
            </div>

            <!-- Payment Verification Queue -->
            <div class="verification-section" id="verificationSection">
                <div class="section-header">
                    <h3><i class="fas fa-clock"></i> Payment Verification Queue</h3>
                    <div class="section-count">
                        <i class="fas fa-hourglass-half"></i>
                        <span id="verificationCount">0</span> Pending
                    </div>
                </div>
                <div class="verification-grid" id="verificationList"></div>
            </div>

            <!-- Verified Orders -->
            <div class="verification-section" id="verifiedSection">
                <div class="section-header">
                    <h3><i class="fas fa-check-circle" style="color: var(--success);"></i> Verified Orders</h3>
                    <div class="section-count" style="color: var(--success);">
                        <i class="fas fa-check"></i>
                        <span id="verifiedCount">0</span> Active
                    </div>
                </div>
                <div class="orders-grid" id="verifiedOrdersList"></div>
            </div>

            <!-- Cancelled Orders -->
            <div class="verification-section" id="cancelledSection">
                <div class="section-header">
                    <h3><i class="fas fa-times-circle" style="color: var(--danger);"></i> Cancelled Orders</h3>
                    <div class="section-count" style="color: var(--danger);">
                        <i class="fas fa-ban"></i>
                        <span id="cancelledCount">0</span> Total
                    </div>
                </div>
                <div class="orders-grid" id="cancelledOrdersList"></div>
            </div>

            <!-- Customer Database -->
            <div class="customer-section" id="customerSection">
                <div class="section-header">
                    <h3><i class="fas fa-users" style="color: var(--purple);"></i> Customer Database</h3>
                    <div class="section-count">
                        <i class="fas fa-user"></i>
                        <span id="customerCount">0</span> Customers
                    </div>
                </div>
                <div class="customers-grid" id="customersList"></div>
            </div>

            <!-- Activity Feed -->
            <div class="activity-section" id="activitySection">
                <div class="section-header">
                    <h3><i class="fas fa-stream"></i> Live Activity Feed</h3>
                    <button class="filter-btn" id="refreshActivity"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>
                <div class="activity-feed" id="activityFeed"></div>
            </div>
        `;
        
        // Add event listeners for filters
        document.getElementById('applyFilter')?.addEventListener('click', applyFilters);
        document.getElementById('resetFilter')?.addEventListener('click', resetFilters);
        document.getElementById('refreshActivity')?.addEventListener('click', () => updateActivityFeed());
        document.getElementById('searchInput')?.addEventListener('input', applyFilters);
    }

    // ==================== FILTER FUNCTIONS ====================
    function applyFilters() {
        const filter = document.getElementById('mainFilter')?.value;
        const search = document.getElementById('searchInput')?.value.toLowerCase();
        
        // Filter orders based on criteria
        const filteredOrders = allOrders.filter(order => {
            if (filter !== 'all' && order.status !== filter && 
                !(filter === 'pending' && order.paymentStatus === 'pending') &&
                !(filter === 'verified' && order.paymentStatus === 'verified')) {
                return false;
            }
            
            if (search) {
                return order.id?.toLowerCase().includes(search) ||
                       order.customerName?.toLowerCase().includes(search) ||
                       order.customerPhone?.includes(search);
            }
            return true;
        });
        
        // Update displays with filtered data
        updateFilteredDisplays(filteredOrders);
    }

    function resetFilters() {
        const mainFilter = document.getElementById('mainFilter');
        const dateFilter = document.getElementById('dateFilter');
        const searchInput = document.getElementById('searchInput');
        
        if (mainFilter) mainFilter.value = 'all';
        if (dateFilter) dateFilter.value = 'all';
        if (searchInput) searchInput.value = '';
        
        updateAllDisplays();
    }

    function updateFilteredDisplays(filteredOrders) {
        // This would update displays with filtered data
        // For now, just refresh all
        updateAllDisplays();
    }

    // ==================== TAB SWITCHING ====================
    function setupTabSwitching() {
        const tabs = {
            dashboardTab: ['verificationSection', 'verifiedSection', 'cancelledSection', 'customerSection', 'activitySection'],
            verificationTab: ['verificationSection'],
            verifiedOrdersTab: ['verifiedSection'],
            cancelledOrdersTab: ['cancelledSection'],
            customersTab: ['customerSection'],
            activityTab: ['activitySection']
        };
        
        Object.keys(tabs).forEach(tabId => {
            document.getElementById(tabId)?.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Update active tab
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                e.currentTarget.classList.add('active');
                
                // Show relevant sections
                const allSections = ['verificationSection', 'verifiedSection', 'cancelledSection', 'customerSection', 'activitySection'];
                allSections.forEach(section => {
                    const el = document.getElementById(section);
                    if (el) el.style.display = 'none';
                });
                
                tabs[tabId].forEach(section => {
                    const el = document.getElementById(section);
                    if (el) el.style.display = 'block';
                });
            });
        });
    }

    // ==================== INITIALIZE ====================
    document.addEventListener('DOMContentLoaded', () => {
        console.log(' Admin Dashboard initializing...');
        
        initAudio();
        initBroadcastSystem();
        loadDashboardContent();
        loadOrdersFromFirebase();
        setupTabSwitching();
        
        // Modal close buttons
        document.getElementById('closeVerifyModal')?.addEventListener('click', () => closeModal('verifyModal'));
        document.getElementById('closeRejectModal')?.addEventListener('click', () => closeModal('rejectModal'));
        document.getElementById('closeStatusModal')?.addEventListener('click', () => closeModal('statusModal'));
        document.getElementById('closeCustomerModal')?.addEventListener('click', () => closeModal('customerModal'));
        document.getElementById('closeFilterModal')?.addEventListener('click', () => closeModal('filterModal'));
        
        document.getElementById('cancelVerification')?.addEventListener('click', () => closeModal('verifyModal'));
        document.getElementById('cancelRejection')?.addEventListener('click', () => closeModal('rejectModal'));
        document.getElementById('cancelUpdate')?.addEventListener('click', () => closeModal('statusModal'));
        
        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal(modal.id);
            });
        });
        
        // Logout button
        document.getElementById('logoutBtn')?.addEventListener('click', () => {
            window.location.href = '/login.html';
        });
        
        console.log(' Admin Dashboard ready');
    });

    // Make functions global
    window.closeModal = closeModal;
    </script>
</body>
</html>

